<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>LBizzo Vape Shop</title>

  <!-- ‚úÖ PWA -->
  <link rel="manifest" href="manifest.json" />
  <meta name="theme-color" content="#ff8c00" />
  <link rel="apple-touch-icon" href="icons/icon-512.png" />
  <meta name="apple-mobile-web-app-capable" content="yes" />
  <meta name="apple-mobile-web-app-status-bar-style" content="black" />
  <link rel="icon" type="image/png" sizes="512x512" href="icons/icon-512.png" />

  <!-- ‚úÖ Styles -->
  <link rel="stylesheet" href="style.css" />

  <!-- ‚úÖ Firebase SDKs -->
  <script defer src="https://www.gstatic.com/firebasejs/9.22.0/firebase-app-compat.js"></script>
  <script defer src="https://www.gstatic.com/firebasejs/9.22.0/firebase-firestore-compat.js"></script>
  <script defer src="https://www.gstatic.com/firebasejs/9.22.0/firebase-storage-compat.js"></script>

  <!-- ‚úÖ EmailJS -->
  <script defer src="https://cdn.jsdelivr.net/npm/@emailjs/browser@3/dist/email.min.js"></script>

  <!-- ‚úÖ Styling for Arrow -->
  <style>
    @keyframes bounce {
      0%, 100% { transform: translateY(0); }
      50% { transform: translateY(-6px); }
    }
    #scanArrow {
      text-align:center;
      font-size:1.2rem;
      color:#ff8c00;
      animation:bounce 1.2s infinite;
      display:none;
      margin-top:8px;
      opacity:1;
      transition:opacity 2s ease;
    }
  </style>
</head>

<body>
  <!-- ‚úÖ AGE GATE -->
  <div id="age-overlay" class="overlay">
    <div class="overlay-card">
      <h2>Are you 21 or older?</h2>
      <div class="age-buttons">
        <button id="yesBtn" class="btn yes">Yes</button>
        <button id="noBtn" class="btn no">No</button>
      </div>
      <small>LBizzo Vape Shop</small>
    </div>
  </div>

  <!-- ‚úÖ HEADER -->
  <header class="topbar">
    <h1>LBizzo Vape Shop</h1>
    <button id="cart-btn" class="btn cart">üõí Cart (<span id="cart-count">0</span>)</button>
    <div id="loyalty-stars" aria-label="Loyalty progress">
      <span class="star" data-i="0">‚òÖ</span>
      <span class="star" data-i="1">‚òÖ</span>
      <span class="star" data-i="2">‚òÖ</span>
      <span class="star" data-i="3">‚òÖ</span>
      <span class="star" data-i="4">‚òÖ</span>
      <span class="star" data-i="5">‚òÖ</span>
      <span class="progress-label">Free vape at 6 ‚≠ê</span>
    </div>
  </header>

  <!-- ‚úÖ PRODUCTS -->
  <main id="product-list" class="product-grid"></main>

  <!-- ‚úÖ CART -->
  <section id="cart" class="cart">
    <h2>Your Cart</h2>
    <ul id="cart-items"></ul>
    <p id="cart-total">Total: $0.00</p>
    <button id="checkout-btn" class="btn primary">Checkout</button>
    <div id="checkout-hint" style="margin-top:6px;font-size:.9rem;color:#888;">üîí Scan ID to enable checkout</div>
  </section>

  <!-- ‚úÖ ID SCANNER -->
  <section id="id-scan" class="scanner">
    <h2>Scan or Upload ID (PDF417/QR)</h2>
    <video id="scanVideo" playsinline muted></video>
    <div class="scan-actions">
      <button id="scanStart" class="btn">Start Scanner</button>
      <button id="scanStop" class="btn">Stop Scanner</button>
    </div>
    <pre id="scanOut"></pre>
    <div id="scanArrow">‚¨áÔ∏è Point camera at BACK of your ID</div>

    <div class="id-upload">
      <h3>Or Take a Photo of Your ID</h3>
      <input type="file" id="idPhotoInput" accept="image/*" capture="environment" class="btn" />
      <p id="idUploadStatus" style="color:#ff8c00;margin-top:8px;"></p>
    </div>
  </section>

  <!-- ‚úÖ APP LOGIC -->
  <script defer src="firebase.js"></script>
  <script defer src="script.js"></script>

  <!-- ‚úÖ GUARANTEED SCANDIT LOADER -->
  <script>
    document.addEventListener("DOMContentLoaded", async () => {
      const scanOut = document.getElementById("scanOut");
      const scanArrow = document.getElementById("scanArrow");

      // 1Ô∏è‚É£ Load Scandit SDK manually if missing
      async function loadScandit() {
        if (window.ScanditSDK) return true;
        return new Promise((resolve, reject) => {
          const script = document.createElement("script");
          script.src = "https://cdn.jsdelivr.net/npm/scandit-sdk@5.x/build/browser/scandit-sdk.min.js";
          script.onload = resolve;
          script.onerror = reject;
          document.head.appendChild(script);
        });
      }

      // 2Ô∏è‚É£ Initialize SDK safely
      async function initScandit() {
        if (scanOut) {
          scanOut.textContent = "‚è≥ Loading Scandit SDK...";
          scanOut.style.color = "#ff8c00";
        }

        try {
          await loadScandit();
          await ScanditSDK.configure(
  "AjeGjTUcEtL1CJWakqGDsHUqNSa2FUaEfgpehFQktDUvftJypGR1uUk4YOe9U57HnWknn6FAegM/Wa/Oul2VLYxdP6h8QNRpqnO6VYQmJrB/Fz8zCSq5ZxMO4g1dbz/yk0KhxtRmyOJUQZ3lPHPLmXRItF4heDTY2040ZyZ7hODuQ7g+6kYMgmRVn8G+Fv5waQ/MN/Rf7YmZYFPd7GGlg5Ry5dTxavIgUWA4H6dGZVnSUvih0lpLVZJ++O79R7YSL2CNET10lSNXXNySjEJ7o31fUt9aeyI1YmqYgLdMSQsDVEBqp3K+OEdPPAg1Qwrrb3S+c7ti7TGoQDhPAExRC61b3frNUhmU80Csg/Rr9GecBDyIbmFEGz52LPQ1a0vT2RpSouZ9gfC0YbTZpEwDNXha9vBcckqEUUeggFAakLpyVRj8231A8bd3emXvehAJRHGhqZNQEJWVeFq31B7mofwKdElOXyEFCSmAgGlY/hq9VPmkt3F4w9UNbPT8YGE5JW4v5JNu6TofHrsdVyEqKQIJNCUKDuNNKQrzA0ESIq/x/gNdCr/PbIjzx7i0L8yeYXuolP1vzJdIvhJvvt8vifaFwtftAmWCUj4GlFBq0e22RwYI7to1tt1IJ3llMZeAP6s6RreABtf8ZpeMyJd9Cw2VF2+7ZWrTNS0j2GqUH78Bt3CYOjli8Bg4YBrlKHjKFYo7jL49/b+4tN3BvSXJbn/7CK+AZ6PjYBKBmuQqQUUwotp7Gvd/0sjt3H7OWrAQb3n8mYK8u6WmJjuLIKQKSt6YoqfPviaj8N7ThlEter9fCXdlhqWDIIiBU0AXbn/jlCEVmhtvSUcXEh2QhNPaig8sLBrjtXnZQh/JNz2x9Xn49PMKUP0C/qia+HS09dfmKgNUDU0ikax1oVu7GlZPrIWhF5R41jZI60TqRMgx5Z4Q4k8oaEw0GLenxOJDxs9ehoPEY634tjJ+NV+8eU9VtOYtiQ5+5WJkf1yMZGtrdpo15xjZZHOjJwusEnEdzoXW1woDQDMrsQn1OnAG6VlALE73S15l9kPSZ1NDknDDitiRlxe1XIn3P7wFwG80QMQY58vTJ1rCdUF2mzg11LbTy/1YZyyn65CjsSGqWQLQrW9z3GoRR7+h35tBltE49sR7+JNR4U+e7qwb52bAQoWa0DLxsiswAAUjZcGevTCpWQvvxwhOqjCNcD/7Fxkpfc5NVvM=",
  { engineLocation: "https://cdn.jsdelivr.net/npm/scandit-sdk@5.x/build/" }
);

          await ScanditSDK.ready();
          console.log("‚úÖ Scandit SDK ready!");
          scanOut.textContent = "üì∏ Scanner ready ‚Äî tap Start Scanner to begin";
          scanOut.style.color = "#00ff88";

          // Show arrow guide
          scanArrow.style.display = "block";
          setTimeout(() => (scanArrow.style.opacity = 0), 5000);

          // Ask for camera access
          navigator.mediaDevices.getUserMedia({ video: true }).catch(() => {
            scanOut.textContent = "‚ö†Ô∏è Please allow camera access in Safari ‚Üí Settings ‚Üí Privacy ‚Üí Camera.";
            scanOut.style.color = "#ff8c00";
          });
        } catch (e) {
          console.error("‚ùå Scandit load failed:", e);
          scanOut.textContent = "‚ùå Scandit failed. Retrying...";
          scanOut.style.color = "#ff4444";
          setTimeout(initScandit, 2500);
        }
      }

      // Run loader
      initScandit();
    });
  </script>
</body>
</html>
