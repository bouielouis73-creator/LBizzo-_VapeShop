<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>LBizzo Vape Shop</title>

  <!-- PWA -->
  <link rel="manifest" href="manifest.json" />
  <meta name="theme-color" content="#ff8c00" />
  <link rel="apple-touch-icon" href="icons/icon-512.png" />
  <link rel="icon" type="image/png" sizes="512x512" href="icons/icon-512.png" />

  <!-- Styles -->
  <link rel="stylesheet" href="style.css" />

  <!-- Firebase SDKs (compat) -->
  <script defer src="https://www.gstatic.com/firebasejs/9.22.0/firebase-app-compat.js"></script>
  <script defer src="https://www.gstatic.com/firebasejs/9.22.0/firebase-firestore-compat.js"></script>
  <script defer src="https://www.gstatic.com/firebasejs/9.22.0/firebase-storage-compat.js"></script>

  <!-- EmailJS -->
  <script defer src="https://cdn.jsdelivr.net/npm/emailjs-com@3/dist/email.min.js"></script>

  <!-- App scripts -->
  <script defer src="firebase.js"></script>
  <script defer src="script.js"></script>
</head>
<body>
  <!-- Age Gate -->
  <div id="age-check" class="overlay">
    <div class="panel">
      <h2>Are you 21 or older?</h2>
      <div class="row">
        <button id="yesBtn" class="btn yes">Yes</button>
        <button id="noBtn" class="btn no">No</button>
      </div>
    </div>
  </div>

  <header class="topbar">
    <h1>LBizzo Vape Shop</h1>
    <div class="actions">
      <button id="install-btn" class="btn ghost" hidden>Install App</button>
      <button id="cart-btn" class="btn cart">
        Cart <span id="cart-count">0</span>
      </button>
    </div>
  </header>

  <!-- Loyalty -->
  <section id="loyalty" class="card">
    <h3>Loyalty Stars (6 = 1 Free)</h3>
    <div class="stars" id="stars"></div>
  </section>

  <!-- Products -->
  <main>
    <section class="card">
      <h2>Products</h2>
      <div id="product-list" class="grid"></div>
      <p id="empty-products" class="muted" hidden>No products found. Add docs to Firestore <code>products</code> with fields <code>name</code>, <code>price</code>, <code>image</code> (path like <code>products/vape1.jpg</code>).</p>
    </section>
  </main>

  <!-- Cart Drawer -->
  <aside id="cart" class="drawer" aria-hidden="true">
    <div class="drawer-inner">
      <div class="drawer-header">
        <h3>Your Cart</h3>
        <button id="close-cart" class="btn ghost">‚úï</button>
      </div>
      <div id="cart-items" class="cart-items"></div>
      <div class="cart-footer">
        <div class="totals">Total: $<span id="total">0.00</span></div>
        <div class="cart-row">
          <button id="clear-cart" class="btn ghost">Clear</button>
          <button id="keep-shopping" class="btn ghost">Keep Shopping</button>
        </div>
      </div>

      <!-- ID Upload + Customer Info (required before checkout) -->
      <form id="id-form" class="id-form">
        <h4>Upload ID (Front & Back) before Checkout</h4>
        <p class="muted">No ID ‚Üí refund issued minus 10% fee.</p>
        <label class="file">
          <span>Front of ID</span>
          <input type="file" id="idFront" name="idFront" accept="image/*" required />
        </label>
        <label class="file">
          <span>Back of ID</span>
          <input type="file" id="idBack" name="idBack" accept="image/*" required />
        </label>

        <h4>Contact / Delivery</h4>
        <input type="text" name="name" id="custName" placeholder="Name" required />
        <input type="tel" name="phone" id="custPhone" placeholder="Phone" required />
        <textarea name="address" id="custAddress" placeholder="Address" rows="2" required></textarea>

        <!-- Hidden fields that script will fill for EmailJS -->
        <input type="hidden" name="items" id="orderItems" />
        <input type="hidden" name="total" id="orderTotal" />

        <!-- ‚úÖ New ID Upload + Verify Section -->
<div id="id-upload-section">
  <label>Front of ID:</label>
  <input type="file" id="front-id" accept="image/*" />

  <label>Back of ID:</label>
  <input type="file" id="back-id" accept="image/*" />

  <button id="send-id-btn" class="btn">Upload & Verify ID</button>
</div>

<!-- Checkout button stays below -->
<button id="checkout-btn" type="submit" class="btn primary" disabled>Submit & Checkout</button>
<p id="id-hint" class="hint">‚¨áÔ∏è Please upload and verify ID first</p>
      </form>
    </div>
  </aside>

  <!-- tiny beep via WebAudio (generated in JS) -->
<!-- üîê LOGIN SECTION (hidden by default, only shows if not logged in) -->
<section id="login-section" style="display:none; text-align:center; padding:20px;">
  <h2>Login or Sign Up</h2>
  <input type="email" id="email" placeholder="Email" autocomplete="email" /><br>
  <input type="password" id="password" placeholder="Password" autocomplete="current-password" /><br>
  <button id="login-btn">Login</button>
  <button id="signup-btn">Sign Up</button>
  <p id="login-status" style="color:#ff8c00; margin-top:10px;"></p>
</section>
</body>
</html>
